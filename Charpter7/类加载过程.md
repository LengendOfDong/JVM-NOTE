# 类加载的过程
## 加载
&emsp;&emsp;”加载“是”类加载“过程的一个阶段，在加载阶段，虚拟机需要完成3件事情：
- 通过一个类的全限定名来获取定义此类的二进制字节流
- 将这个字节流所代表的静态存储结构转化为方法区的运行时数据结构
- 在内存中生成一个代表这个类的java.lang.Class对象，作为方法区这个类的各种数据的访问入口

&emsp;&emsp;对于第一点，可以从多个渠道进行获取二进制字节流：
- 从ZIP包中获取
- 从网络中获取
- 运行时计算生成，例如动态代理技术
- 由其他文件生成，典型场景就是JSP应用，由jsp文件生成对应的Class类
- 从数据库中读取，这种场景相对少些。

## 验证
&emsp;&emsp;验证是连接阶段的第一步，这一阶段的目的是为了确保Class文件的字节流中包含的信息符合当前虚拟机的要求，并且不会危害虚拟机自身的安全。

&emsp;&emsp;验证阶段直接决定了Java虚拟机是否能够承受恶意代码的攻击。从执行性能的角度讲，验证阶段的工作量在虚拟机的类加载子系统中占了相当大的一部分。

&emsp;&emsp;从整体上看，验证阶段大致上会完成下面4个阶段的验证工作：
- 文件格式验证
- 元数据验证
- 字节码验证
- 符号引用验证

&emsp;&emsp;文件格式验证的主要目的是保证输入的字节流能正确地解析并存储于方法区之内，格式上符合描述一个Java类型信息的要求。该阶段的验证是基于二进制字节流进行，后面的验证阶段都是基于方法区的存储结构进行。

&emsp;&emsp;元数据验证是对字节码描述的信息进行语义分析，以保证其描述的信息符合Java语言规范的要求。这一阶段的主要目的是对类的元数据信息进行语义校验，保证不存在不符合Java语言规范的元数据信息。

&emsp;&emsp;字节码验证是整个验证过程中最复杂的一个阶段，主要目的是通过数据流和控制流分析，确定程序语义是合法的，符合逻辑的。这个阶段将对类的方法体进行校验分析，保证被校验类的方法在运行时不会做出危害虚拟机的安全事件。

&emsp;&emsp;第一，先确定格式没有问题；第二，确定内容语义没有问题；第三，确定内容是安全无害的。

&emsp;&emsp;符号引用验证发生在虚拟机将符号引用转化为直接引用的时候，这个转化动作将在连接的第三阶段——解析阶段发生。

&emsp;&emsp;符号引用验证的目的是确保解析动作能正常进行。

## 准备
&emsp;&emsp;准备阶段是正式为类变量分配内存并设置类变量初始值的阶段，这些变量所使用的的内存都将在方法区中进行分配。




