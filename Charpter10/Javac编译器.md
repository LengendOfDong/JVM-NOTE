# 概述
代表性的编译器：
- 前端编译器：Sun的Javac、EclipseJDT中的增量式编译器（ECJ）
- JIT编译器：HotSpot VM的C1/C2编译器
- AOT编译器：GNU Compiler for the Java(GCJ)、Excelsior JET

&emsp;&emsp;Java中即时编译器在运行期的优化过程对于程序运行来说更重要，而前端编译器在编译期的优化过程对于程序编码来说更加密切。

# Javac编译器
&emsp;&emsp;从Sun Javac的代码来看，编译过程大致可以分为3个过程，分别是：
- 解析与填充符号表过程
- 插入式注解处理器的注解处理过程
- 分析与字节码生成过程

## 解析与填充符号表
1） 词法、语法分析

&emsp;&esmp;解析步骤包含经典程序编译原理中的词法分析和语法分析

&emsp;&emsp;词法分析是将源代码的字符流转变为标记（Token）集合，单个字符是程序编写过程的最小元素，而标记是编译过程的最小元素，关键字、变量名、字面量、运
算符都可以成为标记。

&emsp;&emsp;一个标记可以为多个字符组成，如int,因为对于编译过程它是最小元素，不可分割的。

&emsp;&emsp;语法分析师根据Token序列构造抽象语法树的过程。

&emsp;&emsp;抽象语法树（Abstract Syntax Tree,AST）是一种用来描述程序代码语法结构的树形表示方式，语法树的每一个节点都代表着程序代码中的一个语法结构，
例如包、类型、修饰符、运算符、接口、返回值甚至代码注释等都可以是一个语法结构。

2） 填充符号表

&emsp;&emsp;符号表是由一组符号地址和符号信息构成的表格，类似于哈希表中的K-V值对的形式。

&emsp;&emsp;符号表所登记的内容用于语义检查和产生中间代码。在目标代码生成阶段，当对符号名进行地址分配时，符号表是地址分配的依据。

## 注解处理器
&emsp;&emsp;在JDK1.6中提供了一组插入式注解处理器的标准API在编译期间对注解进行处理，可以将其看成是编译器的插件，在这些插件里面，可以读取、修改、添加抽
象语法树中的任意元素。

&emsp;&emsp;注解与普通的代码一样，是在运行期间发挥作用的。插件在处理注解期间对语法树进行了修改，编译器将回到解析及填充符号表的过程重新处理，直到所有
插入式注解处理器都没有再对语法树进行修改为止，每一次循环称为一个Round。

## 语义分析与字节码生成
&emsp;&emsp;语法分析之后，编译器获得了程序代码的抽象语法树表示，语法树能表示一个结构正确的源程序的抽象，但无法保证源程序是符合逻辑的。

&emsp;&emsp;是否合乎语义逻辑必须限定在具体的语言与具体的上下文环境之中才有意义。

1）标注检查
&emsp;&emsp;语义分析过程分为标注检查以及数据及控制流分析两个步骤。

&emsp;&emsp;标注检查步骤检查的内容包括诸如变量使用前是否已被声明、变量与赋值之间的数据类型是否能够匹配等。

&emsp;&emsp;常量折叠，例如int a = 1 + 2，在编译期间进行了常量折叠，变成int a = 3,所以两者是相同的。

2）数据及控制流分析
&emsp;&emsp;数据及控制流分析是对程序上下文逻辑进一步的验证，可以检查出程序局部变量在使用前是否有赋值，方法的每条路径是否都有返回值，是否受查异常都被正确处理等。

&emsp;&emsp;将局部变量声明为final，对运行期是没有影响的，变量的不变性仅仅由编译器在编译期间保障。

3）解语法糖
&emsp;&emsp;语法糖（Syntactic Sugar）,也称为糖衣语法，指在计算机语言中添加的某种语法，这种语法对语言的功能没有影响，但是更方便程序员使用。

&emsp;&emsp;Java中最常用的语法糖主要是泛型、变长参数、自动装箱、自动拆箱等，虚拟机在运行时不支持这些语法，它们在编译阶段还原回简单的基础语法结构，这个过程称为解语法糖。

4）字节码生成
&emsp;&emsp;字节码生成是Javac编译过程的最后一个阶段，字节码生成阶段不仅仅是把前面各个步骤所生成的信息（语法树、符号表）转化成字节码写到磁盘中，编译器还进行了少量的代码添加和转换工作。

&emsp;&emsp;字节码生成阶段会添加代码，例如实例构造器和类构造器方法就是这个阶段添加到语法树之中的。除了生成构造器以外，还有一些代码替换工作用于优化程序的实现逻辑，如把字符串的加操作替换为StringBuffer或StringBuilder的append()操作。

&emsp;&emsp;完成对语法树的遍历和调整之后，就会把填充了所有所需信息的符号表通过writeClass()方法输出字节码，生成最终的字节码文件。
